---
layout: post
title: \[转帖\]用tar备份、还原Linux系统的方法  
date: 2014-02-06
tags: linux tar 备份 还原
---

引言：以下内容在Unix教科书就有，不用就忘。转一个备查。照例原文地址：

http://blog.csdn.net/su\_linux/article/details/6425777

---------------------------------------原文（少许修改）如下---------------------------------------

下面是备份系统的方法： 
--------------------

打开终端，输入以下命令：

1. 成为根用户：

        sudo su

2. 转到根目录：

        cd /

3. 然後，下面就是我用来备份我的系统的完整的命令：

        tar -cvpzf /media/sda7/backup.tgz --exclude=/proc --exclude=/lost+found --exclude=/mnt --exclude=/sys --exclude=/media /

接着，让我们稍微解释一下：
     
> tar 是用来备份的程序

> c - 新建一个备份文档

> v - 详细模式， tar程序将在屏幕上实时输出所有信息。

> p - 保存许可，并应用到所有文件。

> z - 采用‘gzip’压缩备份文件，以减小备份文件体积。  

> f - 说明备份文件存放的路径， /media/sda7/backup.tgz 是本例子中备份文件名。这个备份文件备份的位置是其它分区，也就是原来的WIN分区中。因为我的根目录的空间不足，所以只有备份在其它的地方了。

> --exclude=... - 用exclude指定我们不想备份的东西，因为有些目录是没有多大用处的。确认你不想包含的文件，否则您会得到一个很奇怪的结果。 您也不必备份 /mnt 目录下的东西，除非您有其他分区挂在它下面或者你坚持要备份。您还必须确保没有任何资源挂在 /media 目录下(比如，任何CD或者移动存储介质).否则，剔除/media。

> / - 最後一个参数是我们想要保存的目录. 我们想要保存整个文件系统，使用 / 作为根目录。 

然后就是将来还原系统备份了： 
--------------------------

<div class="note warning">
  <h5>警告:</h5>
  <p>
    求您了，看在上帝的份上，千万小心这儿。如果您不明白您正在干什么，那很有可能复盖掉您重要的数据，所以请特别小心！
  </p>
</div>

好了，继续我们前面所讲的例子，我们在其它分区（sda7）目录下创建了一个名为backup.tgz的备份文件。

Linux 中美妙的事情之一就是在系统正在运行的情况下可以进行还原操作，而不需要启动光盘或者其他任何乱七八糟的东西。当然，如果您的系统已经崩溃，那您必须选择 使用live CD，但是结果还是一样。你甚至可以在Linux系统正在运行的时候，移除它里面所有文件。可是我不告诉你那个命令！

好了，言归正传。这是我要用的命令，如果你的备份不是在和我一样的位置的位置的话，那请相应地修改`/media/sda7`这一点：

    tar -xvpzf /media/disk/backup.tgz -C /

如果您使用的是bz2压缩的：

    tar -xvpjf /media/disk/backup.tar.bz2 -C /

---------------------------------------原文结束---------------------------------------

如果你用做好的tar备份来安装一个linux系统的话解压完之后还有几个步骤需要完成：

1. chroot到刚解压好的系统中
2. 修改fstab
3. 重新配置grub

大致就是这个路子，gentoo手册和clfs手册关于这些内容写得很详细，因为他们就是这么干的。线索足够多了，不再赘述。
